{% extends "stepping_out/__base.html" %}

{% load url from future %}

{% block main %}
{% with dance=scheduled_dance %}
  <h1>{{ dance.name }}{% if dance.venue %} <small>at <a href="{% url 'stepping_out_venue_detail' slug=dance.venue.slug %}">{{ dance.venue.name }}</a></small>{% endif %}</h1>
  <div class="row">
    <div class="span6">
      <h3>This week ({{ next_dance.start|date:"F jS" }})</h3>
      <div class="accordion" id="this-week">
        {% with lessons=next_dance.lessons.all %}
          {% for lesson in lessons %}
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-target="#lesson{{ forloop.count }}" data-parent="#this-week">
                  {{ lesson.name }}{% if lesson.start and lesson.end %}, <time datetime="{{ lesson.start|date:'H:i' }}">{{ lesson.start|date:'g:i a' }}</time> – <time datetime="{{ lesson.end|date:'H:i' }}">{{ lesson.end|date:'g:i a' }}</time>{% endif %}
                </a>
              </div>
              <div class="accordion-body collapse" id="lesson{{ forloop.count }}">
                <div class="accordion-inner">
                  {% if lesson.description %}
                    <p>
                      {{ lesson.description }}
                    </p>
                  {% endif %}
                  {% include "stepping_out/_thumbnails.html" with objects=lesson.teachers.all only %}
                </div>
              </div>
            </div>
          {% endfor %}
        {% endwith %}
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-target="#dance" data-parent="#this-week">
              Dancing{% if next_dance.start and next_dance.end %}, <time datetime="{{ next_dance.start|date:'H:i' }}">{{ next_dance.start|date:'g:i a' }}</time> – <time datetime="{{ next_dance.end|date:'H:i' }}">{{ next_dance.end|date:'g:i a' }}</time>{% endif %}
            </a>
          </div>
          <div class="accordion-body collapse" id="dance">
            <div class="accordion-inner">
              {% with hosts=next_dance.hosts.all %}
                {% if hosts %}
                  <h3>Hosts</h3>
                  {% include "stepping_out/_thumbnails.html" with objects=hosts only %}
                {% endif %}
              {% endwith %}
              {% with djs=next_dance.djs.all %}
                {% if djs %}
                  <h3>DJs</h3>
                  {% include "stepping_out/_thumbnails.html" with objects=djs only %}
                {% endif %}
              {% endwith %}
              {% with live_acts=next_dance.live_acts.all %}
                {% if live_acts %}
                  <h3>Live Acts</h3>
                  {% include "stepping_out/_thumbnails.html" with objects=live_acts only %}
                {% endif %}
              {% endwith %}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="span6">
      {% if dance.venue %}
        {% include "stepping_out/_venue_map.html" with venue=dance.venue only %}
      {% endif %}
      {% if dance.website %}<h4>{{ dance.website|urlize }}</h4>{% endif %}
      <h4>
        {% with weeks=dance.get_weeks %}
          {% if weeks|length == 5 %}
            Every {{ dance.get_weekday_display }}{% else %}
            {% filter capfirst %}{% for week in weeks %}{% if forloop.last and not forloop.first %} and {% endif %}{{ week|lower }}{% if weeks|length > 2 and not forloop.last %}, {% endif %}{% endfor %}
            {% endfilter %}
            {{ dance.get_weekday_display }}{{ weeks|pluralize }}{% endif %}{% if dance.start and dance.end %},
            <time datetime="{{ dance.start|date:'H:i' }}">{{ dance.start|date:'g:i a' }}</time> – <time datetime="{{ dance.end|date:'H:i' }}">{{ dance.end|date:'g:i a' }}</time>
          {% endif %}
        {% endwith %}
      </h4>
      {% with lessons=dance.scheduled_lessons.all %}
        {% if lessons %}
          {% for lesson in lessons %}
            <h4>{{ lesson.name }}{% if lesson.start and lesson.end %}, <time datetime="{{ lesson.start|date:'H:i' }}">{{ lesson.start|date:'g:i a' }}</time> – <time datetime="{{ lesson.end|date:'H:i' }}">{{ lesson.end|date:'g:i a' }}</time>{% endif %}</h4>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>
  </div>
{% endwith %}
{% endblock %}
